<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>L-U-N-E-V | –¢–æ–≤–∞—Ä</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <style>
    .actions-buttons {
      display: flex;
      gap: 15px;
      margin: 20px 0;
    }
    
    .buy-button {
      flex: 1;
      padding: 16px;
      font-size: 22px;
      font-weight: 700;
      text-transform: uppercase;
      color: #fff;
      background: linear-gradient(135deg, #0c10ff, #07f813);
      border: none;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(255,102,0,0.4);
      transition: transform 0.25s, box-shadow 0.25s;
    }
    
    .buy-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(255,102,0,0.5);
    }
    
    .buy-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .favorite-button {
      width: 60px;
      padding: 16px;
      font-size: 24px;
      background: #fff;
      border: 2px solid #0f4d2b;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .favorite-button:hover {
      background: #ffe6e6;
      transform: scale(1.1);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      z-index: 10000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      max-width: 300px;
      color: white;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      background: #4caf50;
    }
    
    .notification.error {
      background: #f44336;
    }
    
    .notification.warning {
      background: #ff9800;
    }
    
    .memory-options button {
      margin-right: 10px;
      margin-bottom: 10px;
      padding: 10px 20px;
      border-radius: 12px;
      border: 2px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .memory-options button:hover {
      border-color: #0f4d2b;
      background: #f0f8f0;
    }
    
    .memory-options button.active {
      border-color: #0f4d2b;
      background: #0f4d2b;
      color: white;
    }
    
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 18px;
      color: #666;
    }
  </style>
</head>
<body>

<header class="header">
  <div class="header-container">
    <div class="header-left">
      <a href="index.html" class="logo">
        <img src="images/logo1.png" alt="L-U-N-E-V" class="logo-img">
      </a>
    </div>
    <div class="header-right">
      <nav class="nav">
        <a href="favorites.html">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        <a href="cart.html">üõí –ö–æ—Ä–∑–∏–Ω–∞</a>
        <a href="login.html" class="login-link">üë§ –í–æ–π—Ç–∏</a>
      </nav>
    </div>
  </div>
</header>

<section class="product-page" id="product-page">
  <div class="loading">
    <p>‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–∞...</p>
  </div>
</section>

<footer class="footer">
  <div class="footer-content">
    <div class="footer-section">
      <h3>L-U-N-E-V</h3>
      <p>–ë—É–¥—É—â–µ–µ –ó–¥–µ—Å—å –∏ –°–µ–π—á–∞—Å. –°–∞–º—ã–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –≥–∞–¥–∂–µ—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞.</p>
      <div class="social-links">
        <a href="#"> VK</a>
        <a href="#"> Telegram</a>
        <a href="#"> Twitter</a>
        <a href="#"> YouTube</a>
      </div>
    </div>
    
    <div class="footer-section">
      <h4>–ú–∞–≥–∞–∑–∏–Ω</h4>
      <ul>
        <li><a href="product-telephone.html">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã</a></li>
        <li><a href="product-consoles.html">–ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å–æ–ª–∏</a></li>
        <li><a href="product-headphone.html">–ù–∞—É—à–Ω–∏–∫–∏</a></li>
        <li><a href="product-port-consoles.html">–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Å–æ–ª–∏</a></li>
        <li><a href="product-washmashine.html">–¢–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –¥–æ–º–∞</a></li>
      </ul>
    </div>
    
    <div class="footer-section">
      <h4>–ü–æ–º–æ—â—å</h4>
      <ul>
        <li><a href="#">–¶–µ–Ω—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏</a></li>
        <li><a href="#">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a></li>
        <li><a href="#">–ì–∞—Ä–∞–Ω—Ç–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç</a></li>
        <li><a href="#">–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</a></li>
        <li><a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
      </ul>
    </div>
    
    <div class="footer-section">
      <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
      <div class="contact-info">
        <p>üìß Email: MR.ANDREW.BRAUNI@mamamia.ru</p>
        <p>üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (914) 123-4-88</p>
        <p>üïí –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 9:00-21:00</p>
        <p>üìç –ê–¥—Ä–µ—Å: –≥. –£–¥–æ–º–ª—è, —É–ª. –ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤, 42</p>
      </div>
    </div>
    
    <div class="footer-section">
      <h4>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h4>
      <div class="security-badges">
        <div>üîí –ó–∞—â–∏—Ç–∞ –µ—Å—Ç—å - –∫–ª—è–Ω—É—Å—å</div>
        <div>üí≥ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ - –º–æ–∂–Ω–æ –∞–≤—à–æ—Ä–∞–º–∏</div>
        <div>üì¶ –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ - 2 –Ω–µ–¥–µ–ª–∏</div>
      </div>
    </div>
  </div>
  
  <div class="footer-bottom">
    <p>¬© 2025 L-U-N-E-V. –ë—É–¥—É—â–µ–µ –ó–¥–µ—Å—å –∏ –°–µ–π—á–∞—Å. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    <div class="footer-links">
      <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
      <a href="#">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
      <a href="#">Cookies</a>
    </div>
  </div>
</footer>

<script>
// –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
const API_BASE_URL = 'http://localhost:3002/api';

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message, type = 'success') {
  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const oldNotifications = document.querySelectorAll('.notification');
  oldNotifications.forEach(n => n.remove());
  
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `<span>${message}</span>`;
  
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 100);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–∞
async function loadProduct() {
  const page = document.getElementById('product-page');
  const params = new URLSearchParams(window.location.search);
  const productId = parseInt(params.get('id')) || 1;
  
  try {
    const response = await fetch(`${API_BASE_URL}/product-by-id/${productId}`);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const data = await response.json();
    
    if (data.status !== 'success') {
      page.innerHTML = `
        <div class="loading">
          <p>‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
          <button onclick="window.location.href='index.html'">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
      `;
      return;
    }
    
    const product = data.product;
    
    // –†–µ–Ω–¥–µ—Ä–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
    page.innerHTML = `
      <div class="product-gallery">
        <div class="thumbnails">
          ${product.images && product.images.length > 0 ? 
            product.images.map((img, index) => `
              <img src="${img}" class="thumb ${index === 0 ? 'active' : ''}" 
                   onclick="changeMainImage('${img}', this)">
            `).join('') : 
            `<img src="${product.main_image}" class="thumb active">`
          }
        </div>
        <div class="main-image">
          <img src="${product.main_image}" alt="${product.name}" id="main-img">
        </div>
      </div>

      <div class="product-info">
        <h1>${product.name}</h1>
        <div class="price">${product.price.toLocaleString('ru-RU')} ‚ÇΩ 
          ${product.bonus_points > 0 ? 
            `<span class="bonus">+${product.bonus_points.toLocaleString('ru-RU')} –±–æ–Ω—É—Å–æ–≤</span>` : 
            ''
          }
        </div>
        
        <div class="actions-buttons">
          <button class="buy-button" id="add-to-cart-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          <button class="favorite-button" id="add-to-fav-btn">‚ù§Ô∏è</button>
        </div>

        ${product.memory_options && product.memory_options.length > 0 ? `
        <div class="memory-options">
          <p><strong>–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å:</strong></p>
          ${product.memory_options.map((mem, index) => 
            `<button class="memory ${index === 0 ? 'active' : ''}" data-memory="${mem}">${mem}</button>`
          ).join('')}
        </div>` : ''}

        ${product.color_options ? `
        <div class="color-options">
          <p><strong>–¶–≤–µ—Ç:</strong> ${product.color_options}</p>
        </div>` : ''}

        ${product.description ? `
        <div class="availability">
          <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
          ${Array.isArray(product.description) ? 
            product.description.map(desc => `<p>${desc}</p>`).join('') : 
            `<p>${product.description}</p>`
          }
        </div>` : ''}

        ${product.delivery_options && product.delivery_options.length > 0 ? `
        <div class="delivery">
          <h3>–î–æ—Å—Ç–∞–≤–∫–∞</h3>
          ${product.delivery_options.map(d => `<p>${d}</p>`).join('')}
        </div>` : ''}
      </div>
    `;
    
    // –ü–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    await checkFavoriteStatus(productId);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    setupEventListeners(productId);
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞:', error);
    page.innerHTML = `
      <div class="loading">
        <p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞</p>
        <p><small>${error.message}</small></p>
        <button onclick="window.location.href='index.html'">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
      </div>
    `;
  }
}

// –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function changeMainImage(src, clickedElement) {
  document.getElementById('main-img').src = src;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞ –º–∏–Ω–∏–∞—Ç—é—Ä–∞—Ö
  document.querySelectorAll('.thumb').forEach(thumb => {
    thumb.classList.remove('active');
  });
  
  if (clickedElement) {
    clickedElement.classList.add('active');
  }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —Ç–æ–≤–∞—Ä –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
async function checkFavoriteStatus(productId) {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const favBtn = document.getElementById('add-to-fav-btn');
  
  if (!currentUser.id || !favBtn) return;
  
  try {
    const response = await fetch(`${API_BASE_URL}/favorites/user/${currentUser.id}`);
    
    if (response.ok) {
      const data = await response.json();
      
      if (data.status === 'success' && data.favorites) {
        const isFavorite = data.favorites.some(fav => fav.product_id == productId);
        
        if (isFavorite) {
          favBtn.textContent = 'üíî';
          favBtn.title = '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ';
        } else {
          favBtn.textContent = '‚ù§Ô∏è';
          favBtn.title = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
        }
      }
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
  }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function setupEventListeners(productId) {
  const cartBtn = document.getElementById('add-to-cart-btn');
  const favBtn = document.getElementById('add-to-fav-btn');
  
  if (cartBtn) {
    cartBtn.addEventListener('click', () => addToCart(productId));
  }
  
  if (favBtn) {
    favBtn.addEventListener('click', () => toggleFavorite(productId));
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞–º—è—Ç–∏
  document.querySelectorAll('.memory').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.memory').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
    });
  });
}

// –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
async function addToCart(productId) {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const cartBtn = document.getElementById('add-to-cart-btn');
  
  if (!currentUser.id) {
    showNotification('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!', 'error');
    setTimeout(() => {
      window.location.href = 'login.html';
    }, 1500);
    return;
  }
  
  // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞–º—è—Ç—å
  const selectedMemory = document.querySelector('.memory.active')?.getAttribute('data-memory') || null;
  const originalText = cartBtn.textContent;
  
  try {
    const response = await fetch(`${API_BASE_URL}/cart/add-item`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        userId: currentUser.id,
        productId: productId,
        quantity: 1,
        selectedMemory: selectedMemory
      })
    });
    
    const data = await response.json();
    
    if (data.status === 'success') {
      cartBtn.textContent = '‚úÖ –í –∫–æ—Ä–∑–∏–Ω–µ';
      cartBtn.disabled = true;
      showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');
      
      // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      setTimeout(() => {
        cartBtn.textContent = originalText;
        cartBtn.disabled = false;
      }, 2000);
    } else {
      showNotification('–û—à–∏–±–∫–∞: ' + data.message, 'error');
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É:', error);
    showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
async function toggleFavorite(productId) {
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const favBtn = document.getElementById('add-to-fav-btn');
  
  if (!currentUser.id) {
    showNotification('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!', 'error');
    setTimeout(() => {
      window.location.href = 'login.html';
    }, 1500);
    return;
  }
  
  const isFavorite = favBtn.textContent === 'üíî';
  
  try {
    if (isFavorite) {
      // –£–¥–∞–ª—è–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
      const response = await fetch(`${API_BASE_URL}/favorites/remove-item`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          userId: currentUser.id,
          productId: productId
        })
      });
      
      const data = await response.json();
      if (data.status === 'success') {
        favBtn.textContent = '‚ù§Ô∏è';
        favBtn.title = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
        showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'success');
      }
    } else {
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
      const response = await fetch(`${API_BASE_URL}/favorites/add-item`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          userId: currentUser.id,
          productId: productId
        })
      });
      
      const data = await response.json();
      if (data.status === 'success') {
        favBtn.textContent = 'üíî';
        favBtn.title = '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ';
        showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!', 'success');
      }
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º:', error);
    showNotification('–û—à–∏–±–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º', 'error');
  }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadProduct);
</script>

<script src="js/header.js"></script>
</body>
</html>