// header.js - –æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
document.addEventListener('DOMContentLoaded', function() {
  updateHeader();
});

function updateHeader() {
  const loggedIn = localStorage.getItem('loggedIn') === 'true';
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  const nav = document.querySelector('.nav');
  const currentPage = window.location.pathname.split('/').pop();
  
  if (nav) {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const activeMap = {
      'index.html': '–ì–ª–∞–≤–Ω–∞—è',
      'favorites.html': '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ',
      'cart.html': '–ö–æ—Ä–∑–∏–Ω–∞',
      'login.html': '–í–æ–π—Ç–∏',
      'register.html': '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
      'profile.html': '–ü—Ä–æ—Ñ–∏–ª—å'
    };
    
    const activePage = activeMap[currentPage] || '';
    
    if (loggedIn) {
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
      const userName = currentUser.firstName || currentUser.first_name || currentUser.username || '–ü—Ä–æ—Ñ–∏–ª—å';
      nav.innerHTML = `
        <a href="favorites.html"${currentPage === 'favorites.html' ? ' class="active"' : ''}>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        <a href="cart.html"${currentPage === 'cart.html' ? ' class="active"' : ''}>üõí –ö–æ—Ä–∑–∏–Ω–∞</a>
        <a href="profile.html" class="user-profile-link${currentPage === 'profile.html' ? ' active' : ''}">
          üë§ ${userName}
        </a>
      `;
    } else {
      // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
      nav.innerHTML = `
        <a href="favorites.html"${currentPage === 'favorites.html' ? ' class="active"' : ''}>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        <a href="cart.html"${currentPage === 'cart.html' ? ' class="active"' : ''}>üõí –ö–æ—Ä–∑–∏–Ω–∞</a>
        <a href="login.html"${currentPage === 'login.html' ? ' class="active"' : ''}>üë§ –í–æ–π—Ç–∏</a>
      `;
    }
  }
}

// –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
window.logout = function() {
  localStorage.removeItem('loggedIn');
  localStorage.removeItem('currentUser');
  updateHeader();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  const notification = document.createElement('div');
  notification.className = 'notification info';
  notification.innerHTML = `
    <div class="notification-content">
      <span>–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</span>
    </div>
  `;
  document.body.appendChild(notification);
  setTimeout(() => notification.classList.add('show'), 100);
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 300);
  }, 2000);
  
  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  setTimeout(() => {
    window.location.href = 'index.html';
  }, 500);
};